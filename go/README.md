# voprf-go

A [golang](https://golang.org/) implementation of the VOPRF protocol in
[draft-irtf-cfrg-voprf](https://datatracker.ietf.org/doc/draft-irtf-cfrg-voprf/).

- [voprf-go](#voprf-go)
  - [Quickstart](#quickstart)
    - [Documentation](#documentation)
    - [Testing & benchmarks](#testing--benchmarks)
    - [Server](#server)
    - [Client](#client)
    - [Generate test vectors](#generate-test-vectors)
    - [Supported ciphersuites](#supported-ciphersuites)
  - [Client Outputs](#client-outputs)
    - [Inputs](#inputs)
    - [Blinds](#blinds)
    - [Outputs](#outputs)
    - [Evaluations](#evaluations)

## Quickstart

### Documentation

Run:

```
./docs.sh
```

and navigate to http://localhost:6060/pkg.

### Testing & benchmarks

Run tests:

```
make test
```

Run benchmarks:

```
make bench
```

### Server

Starts a server for running the (V)OPRF protocol.

- Run server (OPRF):

    ```
    make server
    ```

- Run server (VOPRF):

    ```
    make server VERIFIABLE=true
    ```

    - Expected output:

        ```
        go run main.go --mode=server --max_evals=10 --ciph=<ciphersuite>
        Starting server...
        Server listening on port 3001
        Public key: <public-key>
        ```

### Client

Starts a client that communicates with a running (V)OPRF server (default port 3001).

- Run client (OPRF):

    ```
    make client
    ```

  - Expected output (OPRF):

      ```
      go run main.go --mode=client --n=3 --ciph=<ciphersuite>
      Starting client...
      ***********
      Inputs
      ===========
      ...
      ***********
      ***********
      Blinds
      ===========
      ...
      ***********
      ***********
      Outputs
      ===========
      ...
      ***********
      ***********
      Evaluations
      ===========
      {
      "elements": [
          ...
      ]
      }
      ***********
      ```

- Run client (VOPRF):

    ```
    make client VERIFIABLE=true PUBLIC_KEY=<server_public_key>
    ```

  - Expected output (VOPRF):

      ```
      go run main.go --mode=client --n=3 --ciph=<ciphersuite> --pk=<server_public_key>
      Starting client...
      Setting public key:  <server_public_key>
      ***********
      Inputs
      ===========
      ...
      ***********
      ***********
      Blinds
      ===========
      ...
      ***********
      ***********
      Outputs
      ===========
      ...
      ***********
      ***********
      Evaluations
      ===========
      {
      "elements": [
          ...
      ],
      "proof": [
          ...
      ]
      }
      ***********
      ```

The chosen curve in the ciphersuite can be changed by appending
`CURVE=<chosen_curve>` to the make command. Only `P384` and `P521` are currently
supported.

### Generate test vectors

Run a server:

```
make server-tv TV_IDX=<tv_idx> CIPHERSUITE=<ciphersuite>
```

Run a client:

```
make client-tv TV_IDX=<tv_idx> CIPHERSUITE=<ciphersuite>
```

The setting of `<tv_idx>` corresponds to the index of the test vector that is
used. The ciphersuite can be configured as above, but only verifiable
ciphersuites are supported.

### Supported ciphersuites

- OPRF-P384-HKDF-SHA512-SSWU-RO
- VOPRF-P384-HKDF-SHA512-SSWU-RO
- OPRF-P521-HKDF-SHA512-SSWU-RO
- VOPRF-P521-HKDF-SHA512-SSWU-RO

## Client Outputs

### Inputs

These are the initial inputs (`x`) generated by the client. They are generated as part
of the OPRF_Blind (/VOPRF_Blind) algorithms, and then stored for the purpose of
running OPRF_Finalize (/VOPRF_Finalize) later after the client has received
output from the server.

### Blinds

The scalar values that are used for blinding the group elements generated by
computing `H_1(x)`, where `x` is an input value. Specifically, the blinds are
the values `r` where `P = rH_1(x)` are the group elements sent to the server.

### Outputs

The outputs (denoted by `y`) of OPRF_Finalize (/VOPRF_Finalize) after the server
output is received and validated.

### Evaluations

The array defined by `"elements"` are the group elements `Q = kP` computed by
the server (where `k` is the Server's secret key). The array of elements
`"proof"` are scalar values that are computed as a DLEQ proof object over the
evaluated group elements. The `"proof"` values are only generated when the
server & client are running a VOPRF protocol.
